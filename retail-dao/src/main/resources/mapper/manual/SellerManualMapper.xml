<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jzfq.retail.core.dao.manual.SellerManualMapper" >

    <resultMap id="BaseResultMap" type="com.jzfq.retail.bean.domain.Seller" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jun 27 16:29:15 CST 2018.
        -->
        <id column="seller_id" property="id" jdbcType="INTEGER" />
        <result column="seller_account_id" property="accountId" jdbcType="INTEGER" />
        <result column="seller_member_id" property="memberId" jdbcType="INTEGER" />
        <result column="seller_seller_code" property="sellerCode" jdbcType="VARCHAR" />
        <result column="seller_name" property="name" jdbcType="VARCHAR" />
        <result column="seller_seller_name" property="sellerName" jdbcType="VARCHAR" />
        <result column="seller_seller_title" property="sellerTitle" jdbcType="VARCHAR" />
        <result column="seller_seller_logo" property="sellerLogo" jdbcType="VARCHAR" />
        <result column="seller_seller_bgimg" property="sellerBgimg" jdbcType="VARCHAR" />
        <result column="seller_seller_grade" property="sellerGrade" jdbcType="INTEGER" />
        <result column="seller_seller_style" property="sellerStyle" jdbcType="INTEGER" />
        <result column="seller_score_service" property="scoreService" jdbcType="VARCHAR" />
        <result column="seller_score_deliver_goods" property="scoreDeliverGoods" jdbcType="VARCHAR" />
        <result column="seller_score_description" property="scoreDescription" jdbcType="VARCHAR" />
        <result column="seller_product_number" property="productNumber" jdbcType="INTEGER" />
        <result column="seller_collection_number" property="collectionNumber" jdbcType="INTEGER" />
        <result column="seller_create_time" property="createTime" jdbcType="TIMESTAMP" />
        <result column="seller_sale_money" property="saleMoney" jdbcType="DECIMAL" />
        <result column="seller_order_count" property="orderCount" jdbcType="INTEGER" />
        <result column="seller_order_count_over" property="orderCountOver" jdbcType="INTEGER" />
        <result column="seller_seller_keyword" property="sellerKeyword" jdbcType="VARCHAR" />
        <result column="seller_seller_des" property="sellerDes" jdbcType="VARCHAR" />
        <result column="seller_audit_stage" property="auditStage" jdbcType="INTEGER" />
        <result column="seller_audit_status" property="auditStatus" jdbcType="INTEGER" />
        <result column="seller_judge_stage" property="judgeStage" jdbcType="VARCHAR" />
        <result column="seller_fail_reason" property="failReason" jdbcType="VARCHAR" />
    </resultMap>

    <sql id="Base_Column_List" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jun 27 16:29:15 CST 2018.
        -->
        seller.id as seller_id, seller.account_id as seller_account_id, seller.member_id as seller_member_id,
        seller.seller_code as seller_seller_code, seller.name as seller_name, seller.seller_name as seller_seller_name,
        seller.seller_title as seller_seller_title, seller.seller_logo as seller_seller_logo,
        seller.seller_bgimg as seller_seller_bgimg, seller.seller_grade as seller_seller_grade,
        seller.seller_style as seller_seller_style, seller.score_service as seller_score_service,
        seller.score_deliver_goods as seller_score_deliver_goods, seller.score_description as seller_score_description,
        seller.product_number as seller_product_number, seller.collection_number as seller_collection_number,
        seller.create_time as seller_create_time, seller.sale_money as seller_sale_money,
        seller.order_count as seller_order_count, seller.order_count_over as seller_order_count_over,
        seller.seller_keyword as seller_seller_keyword, seller.seller_des as seller_seller_des,
        seller.audit_stage as seller_audit_stage, seller.audit_status as seller_audit_status,
        seller.judge_stage as seller_judge_stage, seller.fail_reason as seller_fail_reason
    </sql>

    <select id="findList" resultType="map" parameterType="com.jzfq.retail.bean.vo.req.SellerSearchReq">
        SELECT
        s.id AS id,
        s.seller_code AS sellerCode,
        s.seller_name AS sellerName,
        s.seller_title AS sellerTitle,
        s.audit_status AS auditStatus,
        ssc.is_open AS isOpen,
        sc.account_period AS accountPeriod,
        sc.bank_user AS bankUser,
        sc.bank_name AS bankName,
        sc.bank_id AS bankId,
        sc.bank_name_branch AS bankNameBranch,
        sc.brand_name_code AS brandNameCode,
        sc.bank_code AS bankCode
        FROM
        seller s
        LEFT JOIN seller_single_credit ssc ON s.id = ssc.seller_id
        LEFT JOIN seller_company sc ON s.id = sc.seller_id
        <where>
                1 = 1
            <if test="sellerName!=null">
                and s.seller_name like concat('%',#{sellerName},'%')
            </if>
            <if test="merchantId!=null">
                and s.merchant_id = #{merchantId}
            </if>
            <if test="sellerCode!=null">
                and s.seller_code = #{sellerCode}
            </if>
            <if test="sellerTitle!=null">
                and s.seller_title like concat('%',#{sellerTitle},'%')
            </if>
            <if test="auditStatus!=null">
                and s.audit_status = #{auditStatus}
            </if>
        </where>
    </select>

    <!--<select id="findSellerList" resultMap="BaseResultMap" parameterType="com.jzfq.retail.bean.vo.req.SellerSearchReq">
        select
        <include refid="Base_Column_List"/>
        from seller seller
        <where>
            1=1
            <if test="id!=null">
                and seller.id=#{id}
            </if>
            <if test="accountId!=null">
                and seller.account_id=#{accountId}
            </if>
            <if test="memberId!=null">
                and seller.member_id=#{memberId}
            </if>
            <if test="sellerCode!=null">
                and seller.seller_code=#{sellerCode}
            </if>
            <if test="name!=null">
                and seller.name=#{name}
            </if>
            <if test="sellerName!=null">
                and seller.seller_name=#{sellerName}
            </if>
            <if test="sellerStyle!=null">
                and seller.seller_style=#{sellerStyle}
            </if>
            <if test="auditStage!=null">
                and seller.audit_stage=#{auditStage}
            </if>
            <if test="auditStatus!=null">
                and seller.audit_status=#{auditStatus}
            </if>
            <if test="judgeStage!=null">
                and seller.judge_stage=#{judgeStage}
            </if>
        </where>
    </select>
-->

    <select id="findBySellerCode" resultMap="BaseResultMap" parameterType="string">
        select <include refid="Base_Column_List"/> from seller seller where seller.seller_code=#{sellerCode}
    </select>

    <select id="findSellerInfoBySellerLogin" resultType="map" parameterType="string">
        select
          s.id as sellerId,
          s.seller_name as sellerName,
          CONCAT(sa.address_info) as sellerAddress,
          if(ss.start_business_time is null,'',ss.start_business_time) as workStartTime,
          if(ss.end_business_time is null,'',ss.end_business_time) as workEndTime,
          if(ss.store_contacts_mobile is null,'',ss.store_contacts_mobile) as phone
        from seller s
        left join seller_login_permission p on s.id = p.seller_id
        left join seller_address sa on s.id = sa.seller_id
        left join seller_store ss on s.id =ss.seller_id
        where p.seller_login = #{sellerLogin}
    </select>

    <select id="getOptions" resultType="map" parameterType="com.jzfq.retail.bean.vo.req.OptionsSearchReq">
        select id as value, seller_title as label from seller seller
        <where>
            1=1
            <if test="id != null">
                and seller.id = #{id}
            </if>
            <if test="name != null and name != ''">
                and seller.seller_title like concat('%',#{name},'%')
            </if>
        </where>
    </select>
</mapper>